{% if product.available and (product.stock > 0 or settings.without_stock_sale) and not product.upon_request %} {% set productVar = product.Variants ? product.Variants : product.variants %} {% set listVariants = [] %} {% set listVariantsSecond = [] %} {% set variants = [] %} {% set variantName = '' %} {% set variantSecondName = '' %}{% for variant in productVar %}{% if loop.index == 1 %} {% if variant.Sku[1] %} {% set variantSecondName = variant.Sku[1].type %} {% endif %}{% set variantName = variant.Sku[0].type %} {% endif %}{% set stock = variant.stock|number_format - variant.minimum_stock|number_format %}{% if true %}{% if variant.Sku[1] %} {% set variants = variants|merge([{ "id": variant.id, "stock": stock, "option": variant.Sku[0].value, "option2": variant.Sku[1].value }]) %}{% set valueSecond = variant.Sku[1].value %} {% if not (valueSecond in listVariantsSecond) %} {% set listVariantsSecond = listVariantsSecond|merge([valueSecond]) %} {% endif %}{% else %}{% set variants = variants|merge([{ "id": variant.id, "stock": stock, "option": variant.Sku[0].value }]) %}{% endif %}{% set value = variant.Sku[0].value %}{% if not (value in listVariants) %} {% set listVariants = listVariants|merge([value]) %} {% endif %}{% endif %}{% endfor %}<div class="add-to-cart" onclick='cart.showModal({"id": {{ product.id }}, "variant": {{ product.has_variation ? "true" : "false" }}, "list_variant": {{ variants|json_encode }} })'>COMPRAR</div> {% endif %}